{%- layout none -%}
<div id="wishlist-container">
  <h1>Mi Lista de Deseos</h1>
  <div id="wishlist-items"></div>
</div>

<script>
 document.addEventListener('DOMContentLoaded', function() {
  var wishlist = JSON.parse(localStorage.getItem('wishlist')) || []; // Asegúrate de que esto almacena handles, no IDs
  var container = document.getElementById('wishlist-items');

  wishlist.forEach(function(productHandle) {
    fetch(`/products/${productHandle}.js`)
      .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok');
        }
        return response.json();
      })
      .then(product => {
        container.innerHTML += `<div class="wishlist-product" id="wishlist-item-${productHandle}">
                                  <img width=150 height=150 src="${product.featured_image}" alt="${product.title}">
                                  <h3>${product.title}</h3>
                                  <span>${product.variants[0].price}</span>
                                  <button onclick="addToCart(${product.variants[0].id})">Add to Cart</button>
                                  <button onclick="removeFromWishlist('${productHandle}')">Remove</button>
                                </div>`;
      })
      .catch(error => {
        console.error('There was a problem with the fetch operation:', error);
      });
  });
});


function removeFromWishlist(productId) {
  var wishlist = JSON.parse(localStorage.getItem('wishlist')) || [];
  var newWishlist = wishlist.filter(function(item) {
    return item !== productId;
  });
  localStorage.setItem('wishlist', JSON.stringify(newWishlist));
  document.getElementById('wishlist-item-' + productId).remove();
}
if (wishlist.length === 0) {
  container.innerHTML = '<p>Tu lista de deseos está vacía.</p>';
}


</script>